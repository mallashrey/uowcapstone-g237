{% extends 'capstone/layout.html' %}
{% load custom_filter %}
{% block body %}
<div class="mb30" style="display: flex; width: calc(100% + 24px); gap: 20px;">
    <a href="{% url 'ticket_list' 'all' %}" class="task-card">
        <div class="card widget-content bg-plum-plate  b-rad10">
            <div class="widget-content-wrapper text-white" style="gap: 20px;">
                <div class="widget-content-left">
                    <div class="widget-heading">All Tickets</div>
                    <div class="widget-subheading">{{ allTicket }}</div>
                </div>
                <div class="icon-overlay-card">
                    <i class="fa-solid fa-hourglass-start" style="font-size: 1.25rem;"></i>
                </div>
            </div>
        </div>
    </a>
    <a href="{% url 'ticket_list' 'outstanding' %}" class="task-card">
        <div class="card widget-content bg-malibu-beach b-rad10">
            <div class="widget-content-wrapper text-white" style="gap: 20px;">
                <div class="widget-content-left">
                    <div class="widget-heading">Outstanding</div>
                    <div class="widget-subheading">{{ outstanding }}</div>
                </div>
                <div class="icon-overlay-card">
                    <i class="fa-solid fa-hourglass-start" style="font-size: 1.25rem;"></i>
                </div>
            </div>
        </div>
    </a>
    <a href="{% url 'ticket_list' 'resolved' %}" class="task-card">
        <div class="card widget-content bg-grow-early b-rad10">
            <div class="widget-content-wrapper text-white" style="gap: 20px;">
                <div class="widget-content-left">
                    <div class="widget-heading">Resolved</div>
                    <div class="widget-subheading">{{ resolved }}</div>
                </div>
                <div class="icon-overlay-card">
                    <i class="fa-solid fa-hourglass-start" style="font-size: 1.25rem;"></i>
                </div>
            </div>
        </div>
    </a>
    <a href="{% url 'ticket_list' 'due_today' %}" class="task-card">
        <div class="card widget-content bg-sunny-morning b-rad10">
            <div class="widget-content-wrapper text-white" style="gap: 20px;">
                <div class="widget-content-left">
                    <div class="widget-heading">Due Today</div>
                    <div class="widget-subheading">{{ dueToday }}</div>
                </div>
                <div class="icon-overlay-card">
                    <i class="fa-solid fa-hourglass-start" style="font-size: 1.25rem;"></i>
                </div>
            </div>
        </div>
    </a>
    <a href="{% url 'ticket_list' 'overdue' %}" class="task-card">
        <div class="card widget-content bg-strong-bliss b-rad10">
            <div class="widget-content-wrapper text-white" style="gap: 20px;">
                <div class="widget-content-left">
                    <div class="widget-heading">Overdue</div>
                    <div class="widget-subheading">{{ overdue }}</div>
                </div>
                <div class="icon-overlay-card">
                    <i class="fa-solid fa-hourglass-start" style="font-size: 1.25rem;"></i>
                </div>
            </div>
        </div>
    </a>
</div>

<div class="container-card dash-card mt20 mb50">
    
    <div style="padding: 20px;">
        <div class="app-card__header_title" style="margin-bottom: 2.25rem;">
            Projects
        </div>
        <div class="app-card__body">
            <table class="table">
                <thead>
                    <tr>
                        <th class="table-th-header" scope="col" style="width:35%;">Task</th>
                        <th class="table-th-header" scope="col">Priority</th>
                        <th class="table-th-header" scope="col">Watcher</th>
                        <th class="table-th-header" scope="col">Due Date</th>
                        <th class="table-th-header" scope="col">Status</th>
                        <th class="table-th-header" scope="col">Requester</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ticket in tickets %}
                    <tr>
                        <td style="font-size: 0.875rem; font-weight: 600;">
                            <a href="{% url 'ticket_detail' ticket.id ticket.ticket_title_slug %}" style="display: -webkit-box;
                            overflow: hidden;
                            -webkit-line-clamp: 2;
                            -webkit-box-orient: vertical;
                            white-space: pre-wrap;" data-toggle="tooltip" data-title="{{ticket.ticket_title}}">{{ ticket.ticket_title }}</a>
                        </td>
                        <td style="font-size: 0.875rem; text-transform: capitalize; font-weight: 600;">
                            <i class="cc-priority {{ticket.priority|getPriority}}"></i>
                            <span>{{ ticket.priority|removeHypens }}</span>
                        </td>
                        <td>
                            <div class="css-xgstl5">
                                {% if task.assigned_to.all %}
                                    {% for user in task.assigned_to.all %}
                                    <div class="css-1wdn32l" data-toggle="tooltip" data-title="{{user.username}}">
                                        {% if user.img_profile %}
                                        <img  class="rounded-circle css-u226zh" src="/static/{{user.img_profile}}" alt="">
                                        {% else %}
                                        <img  class="rounded-circle css-u226zh" src="/static/images/user-icon.png" alt="">
                                        {% endif %}
                                    </div>
                                    {% endfor %}

                                {% else %}
                                <div style="font-size: 0.875rem; text-transform: capitalize; font-weight: 600; color: #fff;">-</div>
                                {% endif %}
                            </div>
                        </td>
                        <td style="font-size: 0.875rem; text-transform: capitalize; font-weight: 600;">
                            {% if ticket.due_date %}
                                {{ ticket.due_date|date:"Y-m-d" }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td style="font-size: 0.875rem; text-transform: capitalize; font-weight: 600;">
                            <span class="badge rounded-pill {{ticket.status|getCSSStatus}}">{{ticket.status|getStatus}}</span>
                        </td>
                        <td style="font-size: 0.875rem; text-transform: capitalize; font-weight: 600;">
                            {{ ticket.requester.username }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}