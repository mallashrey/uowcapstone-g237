{% extends "capstone/layout.html" %}
{% load custom_filter %}


{% block body %}    

    <script>

        // var toastMixin = Swal.mixin({
        //     toast: true,
        //     icon: 'success',
        //     title: 'General Title',
        //     animation: false,
        //     position: 'top-right',
        //     showConfirmButton: false,
        //     timer: 3000,
        //     timerProgressBar: true,
        //     didOpen: (toast) => {
        //     toast.addEventListener('mouseenter', Swal.stopTimer)
        //     toast.addEventListener('mouseleave', Swal.resumeTimer)
        //     }
        // });

        
        // let url = `ws://${window.location.host}/ws/socket-server/`

        // const chatSocket = new WebSocket(url)

        // chatSocket.onmessage = function(e) {
        //     let data = JSON.parse(e.data)

        //     if (data.payload) {
        //         if (data.payload.user == `{{request.user.username}}`) {
        //             toastMixin.fire({
        //                 animation: true,
        //                 title: 'Signed in Successfully'
        //             });
        //         }
        //     }
            
        //     // console.log('Data:', data)
        //     // console.log(data.payload.msg)
        // }
    </script>


    <!-- <div class="app-page-title">
        <div class="page-title-wrapper">
            <div class="page-title-heading">
                <div class="page-title-icon">
                    <svg viewBox="0 0 512 512" fill="currentColor" class="menu-icon">
                        <path d="M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM288 96a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zM256 416c35.3 0 64-28.7 64-64c0-17.4-6.9-33.1-18.1-44.6L366 161.7c5.3-12.1-.2-26.3-12.3-31.6s-26.3 .2-31.6 12.3L257.9 288c-.6 0-1.3 0-1.9 0c-35.3 0-64 28.7-64 64s28.7 64 64 64zM176 144a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zM96 288a32 32 0 1 0 0-64 32 32 0 1 0 0 64zm352-32a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/>
                    </svg>
                </div>
                <div class="page-title-header">Dashboard
                    <div class="page-title-subheading">This is an example dashboard created using
                        build-in elements and components.
                    </div>
                </div>
            </div>
        </div>
    </div> -->
    

    {% include "capstone/dashboard/ticket-card.html" %}

    <div class="row" style="gap: 25px;">
        <div style="width: 100%; max-width: 500px;">
            <div style="display: flex;
            position: relative;
            gap: 20px;
            height: 340px;
            flex-direction: column;
            backdrop-filter: blur(120px);
            overflow-wrap: break-word;
            box-shadow: rgba(0, 0, 0, 0.05) 0rem 1.25rem 1.6875rem 0rem;
            background: url(../../static/images/ocean.jpg) 50% center / cover border-box;
            background-position: 50% center;
            border-radius: 1.25rem;
            padding: 32px 22px; justify-content: space-between;">
                <div>
                    <div class="greeting-msg mb10" style="color: #c8dbf4; font-weight: 500;"></div>
                    <div class="mb10" style="text-transform: capitalize; color: #fff; font-size: 1.875rem; font-weight: 700;">{{ request.user.first_name }} {{ request.user.last_name }}</div>
                    <div style="color: #c8dbf4; font-weight: 500;">Glad to see you again</div>
                </div>
                <div class="clock-container">
                    <div class="clock"></div>
                    <div class="date"></div>
                </div>
                
                
            </div>
        </div>
        
        {% if request.user.dept == 1 %}
        <div class="container-card dash-card">
            <div style="padding: 20px;">
                <div class="app-card__header_title mb30" style="text-align: center;">
                    Personalities
                </div>
                <div class="app-card__body card-outline">
                    <div style="display: flex; gap: 15px; align-items: center;">

                        <div>
                            <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
                                <svg class="radial-progress" data-percentage="{{ personalities.first.value }}" viewBox="0 0 80 80">
                                    <defs>
                                        <linearGradient id="linear" x1="10%" y1="90%" x2="0%" y2="10%">
                                            <stop offset="0%" stop-color="#3fffa2" />
                                            <stop offset="50%" stop-color="#ffdb3a" />
                                            <stop offset="100%" stop-color="#ff6363" />
                                        </linearGradient>
                                    </defs>
                                    <circle class="incomplete" cx="40" cy="40" r="35"></circle>
                                    <circle class="complete" cx="40" cy="40" r="35"
                                        style="stroke-dashoffset: 147.3406954533613;"></circle>
                                    <text class="percentage count" x="50%" y="57%" transform="matrix(0, 1, -1, 0, 80, 0)">{{ personalities.first.value }}</text>
                                </svg>
                                <h3 class="card-text-body">{{ personalities.first.mbti_type }}</h3>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 20px;">
                            {% for res in personalities %}
                                {% if not forloop.first %}
                                <div class="personality-dash-card">
                                    <div style=" font-family: 'Plus Jakarta Display', Helvetica, Arial, sans-serif;
                                    font-size: 0.875rem;
                                    line-height: 1.5;
                                    opacity: 1;
                                    text-transform: none;
                                    vertical-align: unset;
                                    color: rgb(160, 174, 192);
                                    font-weight: 400;
                                    margin: 0px 0px 5px;
                                    text-decoration: none;"> 
                                    {% if forloop.counter == 2%}
                                    Second
                                    {% else %}
                                    Third
                                    {% endif %}
                                </div>
                                <div class="card-text-body">{{ res.mbti_type }}</div>
                                <div class="card-text-body count">{{ res.value }}%</div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="app-card_footer mt20">
                    {% if personalities %}
                    <a href="{% url 'mbti_result' request.user.username %}" class="more-detail">
                        <span>See detail </span>
                        <i class="fa-solid fa-arrow-right"></i>
                    </a>
                    {% else %}
                    <a href="{% url 'questionnaire' request.user.username %}" class="more-detail">
                        <span>Take the test now</span>
                        <i class="fa-solid fa-arrow-right"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="notifications">
        <!-- li toast -->
    </div>
    <div class="buttons">
        <button class="btn" id="success">test</button>
    </div>

    {% include "capstone/dashboard/project.html" %}

{% endblock %}